# draw_pixel() Visual Explanation

## The Image in Memory

### Conceptual Grid View (what you think)
```
     xâ†’ 0    1    2    3    4    5  ...
yâ†“  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
 0  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
    â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
 1  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
    â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
 2  â”‚    â”‚    â”‚ â–ˆâ–ˆ â”‚    â”‚    â”‚    â”‚  â† want to draw at (2,2)
    â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
 3  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
    â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
```

### Actual Memory Layout (how it's stored)
```
Memory is ONE LONG ARRAY of bytes:

img->addr points here
     â†“
â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚...
â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜
 â†â”€â”€â”€ Row 0 â”€â”€â”€â”€â†’â†â”€â”€â”€ Row 1 â”€â”€â”€â”€â†’â†â”€â”€â”€ Row 2 â”€â”€â”€â”€â†’â†â”€â”€â”€ Row 3 â”€â”€â”€â”€â†’
```

## How Pixels Map to Memory

### Each pixel = 4 bytes (when bpp = 32)
```
One Pixel (32 bits = 4 bytes):
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ ?? â”‚ RR â”‚ GG â”‚ BB â”‚  â† Color format: 0x00RRGGBB
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
  â†‘    â†‘    â†‘    â†‘
byte0 byte1 byte2 byte3
```

### Row Layout (line_len = bytes per row)
```
If width = 6 pixels, bpp = 32:
Each row = 6 pixels Ã— 4 bytes/pixel = 24 bytes

Row 0: [px0][px1][px2][px3][px4][px5]
       â†‘â”€4â”€â†’â†‘â”€4â”€â†’â†‘â”€4â”€â†’â†‘â”€4â”€â†’â†‘â”€4â”€â†’â†‘â”€4â”€â†’  = 24 bytes total
       
img->line_len = 24
```

## Finding Pixel (x=2, y=2)

### Step 1: Calculate offset
```
offset = y * img->line_len + x * (img->bpp / 8)

Given:
- x = 2
- y = 2  
- line_len = 24 (bytes per row)
- bpp = 32 (bits per pixel) â†’ bpp/8 = 4 bytes per pixel

offset = 2 * 24 + 2 * 4
offset = 48 + 8
offset = 56 bytes
```

### Step 2: Visual memory map
```
Memory layout with 6 pixels per row:

Byte:  0   4   8  12  16  20  24  28  32  36  40  44  48  52  56  60  64  68
      â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
      â”‚p00â”‚p01â”‚p02â”‚p03â”‚p04â”‚p05â”‚p10â”‚p11â”‚p12â”‚p13â”‚p14â”‚p15â”‚p20â”‚p21â”‚p22â”‚p23â”‚p24â”‚p25â”‚
      â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
       â†â”€â”€â”€â”€â”€â”€ Row 0 â”€â”€â”€â”€â”€â”€â†’â†â”€â”€â”€â”€â”€â”€ Row 1 â”€â”€â”€â”€â”€â”€â†’â†â”€â”€â”€â”€â”€â”€ Row 2 â”€â”€â”€â”€â”€â”€â†’
                                                           â†‘
                                                      offset = 56
                                                      This is pixel(2,2)!
```

### Step 3: Get pointer and write
```c
dst = img->addr + offset;
//    img->addr points to byte 0
//    + 56 bytes
//    = points to byte 56 (start of pixel at 2,2)

*(int *)dst = color;
//    Write 4 bytes starting at byte 56
```

## Complete Example: Drawing Red at (2,2)

```
BEFORE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 00 00 00 00 | 00 00 00 00 | ... | 00 00 00 00 | 00 00 00 00 | ... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†‘ byte 56-59 (pixel 2,2)

draw_pixel(&img, 2, 2, 0x00FF0000);  // Red color

AFTER:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 00 00 00 00 | 00 00 00 00 | ... | 00 FF 00 00 | 00 00 00 00 | ... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†‘ byte 56-59 = RED!
                                     (00 = alpha, FF = red, 00 = green, 00 = blue)
```

## Real Numbers Example (1920Ã—1080 frame)

```
Frame specs:
- width = 1920 pixels
- height = 1080 pixels  
- bpp = 32
- line_len = 7680 bytes (= 1920 Ã— 4)

Draw at pixel (100, 50):

offset = 50 Ã— 7680 + 100 Ã— 4
       = 384,000 + 400
       = 384,400 bytes

Memory:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Row 0 (7680 bytes)                                               â”‚
â”‚ Row 1 (7680 bytes)                                               â”‚
â”‚ ...                                                              â”‚
â”‚ Row 49 (7680 bytes)                                              â”‚
â”‚ Row 50: [0-399 bytes...] [400-403: WRITE HERE!] [404+ bytes...] â”‚
â”‚ ...                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†‘
                         offset 384,400
                         Pixel (100,50)
```

## The Formula Breakdown

```
offset = y * line_len + x * (bpp/8)
         â†‘              â†‘
         |              â””â”€ How many bytes to skip horizontally (columns)
         |
         â””â”€ How many bytes to skip vertically (rows)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Skip Y complete rows               â”‚ = y * line_len
â”‚  Then skip X pixels in current row  â”‚ = x * bytes_per_pixel
â”‚  = Total offset from start          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Bounds Checking Visual

```
Image bounds: width=4, height=3

Valid coordinates (green âœ“):
     0   1   2   3
   â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
0  â”‚ âœ“ â”‚ âœ“ â”‚ âœ“ â”‚ âœ“ â”‚
   â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
1  â”‚ âœ“ â”‚ âœ“ â”‚ âœ“ â”‚ âœ“ â”‚
   â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
2  â”‚ âœ“ â”‚ âœ“ â”‚ âœ“ â”‚ âœ“ â”‚
   â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜

Invalid coordinates (red âœ—):
- (-1, 0) âœ—  â† x < 0
- (0, -1) âœ—  â† y < 0  
- (4, 0)  âœ—  â† x >= width
- (0, 3)  âœ—  â† y >= height
- (5, 5)  âœ—  â† both out of bounds

The check prevents crashes:
if (x < 0 || x >= img->width || y < 0 || y >= img->height)
    return;  // Don't write!
```

## Summary Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ draw_pixel(img, x, y, color)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. Check bounds                                             â”‚
â”‚     if (out of range) â†’ return                               â”‚
â”‚                                                              â”‚
â”‚  2. Calculate offset                                         â”‚
â”‚     offset = y * line_len + x * (bpp/8)                      â”‚
â”‚                â†“           â†“                                 â”‚
â”‚          rows to skip  columns to skip                       â”‚
â”‚                                                              â”‚
â”‚  3. Get pointer                                              â”‚
â”‚     dst = img->addr + offset                                 â”‚
â”‚           â†‘            â†‘                                     â”‚
â”‚      start of        how far to                              â”‚
â”‚      image data      move forward                            â”‚
â”‚                                                              â”‚
â”‚  4. Write color                                              â”‚
â”‚     *(int *)dst = color                                      â”‚
â”‚      write 4 bytes at that location                          â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Animation of Writing Multiple Pixels

```
Initial empty 4Ã—3 image (all black = 0x00000000):

â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚    â”‚    â”‚    â”‚    â”‚  Row 0
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚    â”‚    â”‚    â”‚    â”‚  Row 1
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚    â”‚    â”‚    â”‚    â”‚  Row 2
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜

draw_pixel(img, 1, 0, RED);    // (1,0) becomes red
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚    â”‚ ğŸ”´ â”‚    â”‚    â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚    â”‚    â”‚    â”‚    â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚    â”‚    â”‚    â”‚    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜

draw_pixel(img, 2, 1, GREEN);  // (2,1) becomes green
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚    â”‚ ğŸ”´ â”‚    â”‚    â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚    â”‚    â”‚ ğŸŸ¢ â”‚    â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚    â”‚    â”‚    â”‚    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜

draw_pixel(img, 0, 2, BLUE);   // (0,2) becomes blue
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚    â”‚ ğŸ”´ â”‚    â”‚    â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚    â”‚    â”‚ ğŸŸ¢ â”‚    â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚ ğŸ”µ â”‚    â”‚    â”‚    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜

Each call calculates offset, finds memory location, writes color!
```
